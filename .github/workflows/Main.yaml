---
name: Package Test Publish

on: push

# https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions

jobs:
  Package_For_PIP:
    uses: ./.github/workflows/Package.yaml

  # Regression_Tests:
  #   needs:
  #     - Package_For_PIP
  #   uses: ./.github/workflows/Regression_Tests.yaml

  Check Changes:
    uses: dorny/paths-filter@v2
    id: changes
    with:
      filters: |
        agent:
          - 'rfswarm_agent/**'
          - 'Tests/Regression/Agent/**'
        manager:
          - 'rfswarm_manager/**'
          - 'Tests/Regression/Manager/**'
        reporter:
          - 'rfswarm_reporter/**'
          - 'Tests/Regression/Reporter/**'

  Regression_Tests_Agent:
    if: steps.changes.outputs.agent == 'true'
    needs:
      - Package_For_PIP
    uses: ./.github/workflows/Regression_Tests_Agent.yaml

  Regression_Tests_Manager:
    if: steps.changes.outputs.manager == 'true'
    needs:
      - Package_For_PIP
    uses: ./.github/workflows/Regression_Tests_Manager.yaml

  Regression_Tests_Reporter:
    if: steps.changes.outputs.reporter == 'true'
    needs:
      - Package_For_PIP
    uses: ./.github/workflows/Regression_Tests_Reporter.yaml

  Publish_Package:
    if: github.repository_owner == 'damies13'
    needs:
    - Package_For_PIP
    # - Regression_Tests
    - Regression_Tests_Agent
    - Regression_Tests_Manager
    - Regression_Tests_Reporter
    uses: ./.github/workflows/Publish.yaml
